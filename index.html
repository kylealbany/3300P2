<html>
<head>
    <title>Voting Records & Region Demographics</title>
<!-- Load the d3 library. -->
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<!-- Load d3 Map Data -->
    <script src="http://d3js.org/topojson.v1.min.js"></script>
<!-- Load Google Fonts & CSS -->
    <link href='https://fonts.googleapis.com/css?family=Bitter' rel='stylesheet' type='text/css'>
    <link href='stylesheet.css' rel='stylesheet' type='text/css'>
<!-- Jquery & JS links go here -->

<!-- Load the Master JSON file  & Restructure it -->
    <script>
    var globalData;
    d3.json("summary2.json", function(error, data){
        if(error){
            console.log(error);
        }
        globalJSON = fixFIPS(data);
    });
    
    var globalJSON;
    
    </script>
</head>

<body>

<div class="body-wrapper">
    <div id="title-card">
        <h1> Voting Records and Region Demographics </h1>
        <hr>
        <h3> An Interactive View into American Political Alignments </h3>
    </div>
    <div id="paragraph">
        <p> This is an introductory paragraph that will explain a few things before we go
        into our main plot. It could potentially explain how to use the graph, and maybe 
        even the rationale as to why we are doing this data visualization in the first place.</p>
    </div>
    <div id="mapholder">
        <div id="map">
        </div>
        <div id="info-box">
            <p> Filtering Options </p>
                <div id="slider"></div>
                <div id="dynamic-data"></div>
        </div>
    </div>
</div>
<div class="body-wrapper">
    <hr>
    <p> Bonus stats if we want them... </p>
</div>

<script>
var width = 1000;
var height = 500;


var projection = d3.geo.albersUsa()
	.scale(1000);

var path = d3.geo.path()
	.projection(projection);

var svg = d3.select("#map").append("svg")
    .attr("width", width)
    .attr("height", height);

var zoom = d3.behavior.zoom()
    .translate(projection.translate())
    .scale(projection.scale())
    .scaleExtent([2*height, 8 * height])
    .on("zoom", zoomed);

var g = svg.append("g")
	.call(zoom);


d3.json("us.json", function(error, us) {


	g.append("g")
	    .selectAll("path")
    	    .data(topojson.feature(us, us.objects.counties).features)
    	.enter().append("path")
        	.attr("d", path)
        	.style("fill", "cccccc")
        	.style("stroke", "888888")
        	.on('mousedown.log', countyClicked);

	g.append("g")
	    .selectAll("path")
    	    .data(topojson.feature(us, us.objects.states).features)
    	.enter().append("path")
        	.attr("d", path)
        	.style("fill", "cccccc")
        	.style("stroke", "888888")
        	.on('mousedown.log', stateClicked);


});

var currentState;
var currentCounty;

//Zoom in to county view of state when it is clicked
function stateClicked(d) {
	var x, y;
	var zoom = 3;


	console.log(globalJSON);


	if(currentState != null){
		currentState.attr("display", "initial");
	}
	
	currentState = d3.select(this);
	currentState.attr("display", "none");

    var centroid = path.centroid(d);
    x = centroid[0];
    y = centroid[1];

	g.transition()
      .duration(1000)
      .attr("transform", "translate(" + width/2 + "," + height/2 + ")scale(" + zoom + ")translate(" + -x + "," + -y + ")");


}

//Change function later, currently zooms out to state view and logs county id when clicked
function countyClicked(d){
	console.log(d.id);


	if(currentState != null){
		currentState.attr("display", "initial");
	}

	g.transition()
      .duration(1000)
      .attr("transform", "scale(" + 1 + ")");
      
    // Write county info to the infobox
    var infobox = d3.select("#dynamic-data");
    
}

//Color in the county that is clicked on
function colorCounty(d){
	currentCounty = d3.select(this);
	currentCounty.style("fill", "FF0000");
}

//Currently just a copy of the functionality for countyClicked to zoom back to state level
function zoomOut(){

	if(currentState != null){
		currentState.attr("display", "initial");
	}

	g.transition()
      .duration(1000)
      .attr("transform", "scale(" + 1 + ")");
}

//Used for d3 mousewheel scrolling
function zoomed() {
  projection.translate(d3.event.translate).scale(d3.event.scale);
  g.selectAll("path").attr("d", path);
}


//Not correct yet, issues because of string/int types and concatenation instead of adding
function fixFIPS(json) {
	for(var i = 0; i < json.length; i++) {
		var obj=json[i];
		if (obj["State Postal"] == "AK"){
			obj["County FIPS Code"] += 02000;
		}
		else if (obj["State Postal"] == "AL"){
			obj["County FIPS Code"] += 01000;
		}
		else if (obj["State Postal"] == "AR"){
			obj["County FIPS Code"] += 05000;
		}
		else if (obj["State Postal"] == "AZ"){
			obj["County FIPS Code"] += 04000;
		}
		else if (obj["State Postal"] == "CA"){
			obj["County FIPS Code"] += 06000;
		}
		else if (obj["State Postal"] == "CO"){
			obj["County FIPS Code"] += 08000;
		}
		else if (obj["State Postal"] == "CT"){
			obj["County FIPS Code"] += 09000;
		}
		else if (obj["State Postal"] == "DC"){
			obj["County FIPS Code"] += 11000;
		}
		else if (obj["State Postal"] == "DE"){
			obj["County FIPS Code"] += 10000;
		}
		else if (obj["State Postal"] == "FL"){
			obj["County FIPS Code"] += 12000;
		}
		else if (obj["State Postal"] == "GA"){
			obj["County FIPS Code"] += 13000;
		}
		else if (obj["State Postal"] == "HI"){
			obj["County FIPS Code"] += 15000;
		}
		else if (obj["State Postal"] == "IA"){
			obj["County FIPS Code"] += 19000;
		}
		else if (obj["State Postal"] == "ID"){
			obj["County FIPS Code"] += 16000;
		}
		else if (obj["State Postal"] == "IL"){
			obj["County FIPS Code"] += 17000;
		}
		else if (obj["State Postal"] == "IN"){
			obj["County FIPS Code"] += 18000;
		}
		else if (obj["State Postal"] == "KS"){
			obj["County FIPS Code"] += 20000;
		}
		else if (obj["State Postal"] == "KY"){
			obj["County FIPS Code"] += 21000;
		}
		else if (obj["State Postal"] == "LA"){
			obj["County FIPS Code"] += 22000;
		}
		else if (obj["State Postal"] == "MA"){
			obj["County FIPS Code"] += 25000;
		}
		else if (obj["State Postal"] == "MD"){
			obj["County FIPS Code"] += 24000;
		}
		else if (obj["State Postal"] == "ME"){
			obj["County FIPS Code"] += 23000;
		}
		else if (obj["State Postal"] == "MI"){
			obj["County FIPS Code"] += 26000;
		}
		else if (obj["State Postal"] == "MN"){
			obj["County FIPS Code"] += 27000;
		}
		else if (obj["State Postal"] == "MO"){
			obj["County FIPS Code"] += 29000;
		}
		else if (obj["State Postal"] == "MS"){
			obj["County FIPS Code"] += 28000;
		}
		else if (obj["State Postal"] == "MT"){
			obj["County FIPS Code"] += 30000;
		}
		else if (obj["State Postal"] == "NC"){
			obj["County FIPS Code"] += 37000;
		}
		else if (obj["State Postal"] == "ND"){
			obj["County FIPS Code"] += 38000;
		}
		else if (obj["State Postal"] == "NE"){
			obj["County FIPS Code"] += 31000;
		}
		else if (obj["State Postal"] == "NH"){
			obj["County FIPS Code"] += 33000;
		}
		else if (obj["State Postal"] == "NJ"){
			obj["County FIPS Code"] = 34000;
		}
		else if (obj["State Postal"] == "NM"){
			obj["County FIPS Code"] += 35000;
		}
		else if (obj["State Postal"] == "NV"){
			obj["County FIPS Code"] += 32000;
		}
		else if (obj["State Postal"] == "NY"){
			obj["County FIPS Code"] += 36000;
		}
		else if (obj["State Postal"] == "OH"){
			obj["County FIPS Code"] += 39000;
		}
		else if (obj["State Postal"] == "OK"){
			obj["County FIPS Code"] += 40000;
		}
		else if (obj["State Postal"] == "OR"){
			obj["County FIPS Code"] += 41000;
		}
		else if (obj["State Postal"] == "PA"){
			obj["County FIPS Code"] += 42000;
		}
		else if (obj["State Postal"] == "RI"){
			obj["County FIPS Code"] += 44000;
		}
		else if (obj["State Postal"] == "SC"){
			obj["County FIPS Code"] += 45000;
		}
		else if (obj["State Postal"] == "SD"){
			obj["County FIPS Code"] += 46000;
		}
		else if (obj["State Postal"] == "TN"){
			obj["County FIPS Code"] += 47000;
		}
		else if (obj["State Postal"] == "TX"){
			obj["County FIPS Code"] += 48000;
		}
		else if (obj["State Postal"] == "UT"){
			obj["County FIPS Code"] += 49000;
		}
		else if (obj["State Postal"] == "VA"){
			obj["County FIPS Code"] += 51000;
		}
		else if (obj["State Postal"] == "VT"){
			obj["County FIPS Code"] += 50000;
		}
		else if (obj["State Postal"] == "WA"){
			obj["County FIPS Code"] += 53000;
		}
		else if (obj["State Postal"] == "WI"){
			obj["County FIPS Code"] += 55000;
		}
		else if (obj["State Postal"] == "WV"){
			obj["County FIPS Code"] += 54000;
		}
		else if (obj["State Postal"] == "WY"){
			obj["County FIPS Code"] += 56000;
		}
		else {
			console.log(obj);
		}
	}
}

</script>
</body>
</html>